<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Family Relationship Explorer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", system-ui, sans-serif;
    }

    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #f4f5f7;
      color: #111827;
    }

    .container {
      background: #ffffff;
      padding: 32px 28px 28px;
      border-radius: 16px;
      box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
      max-width: 640px;
      width: 100%;
    }

    .question-row {
      font-size: 1.25rem;
      line-height: 1.6;
      text-align: center;
    }

    select {
      font-size: 1rem;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #ffffff;
      max-width: 260px;
    }

    select:focus {
      outline: none;
      border-color: #4f46e5;
      box-shadow: 0 0 0 1px #4f46e5;
    }

    .answer {
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
      min-height: 24px;
    }

    .answer-label {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: #6b7280;
      margin-bottom: 4px;
    }

    .answer-path {
      font-size: 1.05rem;
      font-weight: 500;
      color: #111827;
      word-break: break-word;
    }

    .hint {
      margin-top: 8px;
      font-size: 0.8rem;
      color: #9ca3af;
      text-align: center;
    }

    .muted {
      color: #9ca3af;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="question-row">
      How is
      <select id="target-select">
        <option value="">select a person</option>
      </select>
      related to me?
    </div>
    <div class="answer" id="answer">
      <div class="answer-label">Relationship path</div>
      <div class="answer-path muted">Pick someone to see how they connect to you.</div>
    </div>
  </div>

  <script>
    // Fixed "me" id for v0 (Chinmay)
    const ME_ID = 1;

    // v0 data: 7 people
    // 1: Chinmay Deo (me)
    // 2: Sanjita Israni (wife)
    // 3: Kedar Deo (father)
    // 4: Nishigandha Deo (mother)
    // 5: Jitendra Israni (father-in-law)
    // 6: Taruna Israni (mother-in-law)
    // 7: Jigglypuff (child)

    const data = {
      people: [
        { id: 1, name: "Chinmay Deo" },
        { id: 2, name: "Sanjita Israni" },
        { id: 3, name: "Kedar Deo" },
        { id: 4, name: "Nishigandha Deo" },
        { id: 5, name: "Jitendra Israni" },
        { id: 6, name: "Taruna Israni" },
        { id: 7, name: "Jigglypuff" }
      ],
      relationships: [
        // Parents of Chinmay
        { from_id: 3, to_id: 1, type: "parent" }, // Kedar -> Chinmay
        { from_id: 4, to_id: 1, type: "parent" }, // Nishigandha -> Chinmay

        // Parents of Sanjita
        { from_id: 5, to_id: 2, type: "parent" }, // Jitendra -> Sanjita
        { from_id: 6, to_id: 2, type: "parent" }, // Taruna -> Sanjita

        // Spouses
        { from_id: 1, to_id: 2, type: "spouse" }, // Chinmay & Sanjita
        { from_id: 3, to_id: 4, type: "spouse" }, // Kedar & Nishigandha
        { from_id: 5, to_id: 6, type: "spouse" }, // Jitendra & Taruna

        // Parents of Jigglypuff
        { from_id: 1, to_id: 7, type: "parent" }, // Chinmay -> Jigglypuff
        { from_id: 2, to_id: 7, type: "parent" }  // Sanjita -> Jigglypuff
      ]
    };

    function buildAdjacencyList(relationships) {
      const adj = new Map();

      function addEdge(a, b) {
        if (!adj.has(a)) adj.set(a, []);
        adj.get(a).push(b);
      }

      for (const rel of relationships) {
        const { from_id, to_id } = rel;
        // Undirected graph for pathfinding: add both directions
        addEdge(from_id, to_id);
        addEdge(to_id, from_id);
      }

      return adj;
    }

    function bfsPath(startId, targetId, adj) {
      if (startId === targetId) {
        return [startId];
      }

      const queue = [startId];
      const visited = new Set([startId]);
      const parent = new Map(); // childId -> parentId

      while (queue.length > 0) {
        const current = queue.shift();
        const neighbours = adj.get(current) || [];

        for (const next of neighbours) {
          if (!visited.has(next)) {
            visited.add(next);
            parent.set(next, current);
            if (next === targetId) {
              // Reconstruct path
              const path = [targetId];
              let cur = targetId;
              while (parent.has(cur)) {
                cur = parent.get(cur);
                path.push(cur);
              }
              return path.reverse();
            }
            queue.push(next);
          }
        }
      }

      // No path found
      return null;
    }

    function getPersonById(id) {
      return data.people.find(p => p.id === id) || null;
    }

    function getRelationshipLabel(aId, bId) {
      const rel = data.relationships.find(
        r =>
          (r.from_id === aId && r.to_id === bId) ||
          (r.from_id === bId && r.to_id === aId)
      );
      if (!rel) return "";
      if (rel.type === "spouse") return "spouse of";
      if (rel.type === "sibling") return "sibling of";
      if (rel.type === "parent") {
        // Directional: from_id is parent of to_id
        return rel.from_id === aId ? "parent of" : "child of";
      }
      return "";
    }

    function renderPath(pathIds) {
      const answerEl = document.getElementById("answer");
      const labelEl = answerEl.querySelector(".answer-label");
      const pathEl = answerEl.querySelector(".answer-path");

      if (!pathIds || pathIds.length === 0) {
        labelEl.textContent = "Relationship path";
        pathEl.textContent = "No path found.";
        pathEl.classList.remove("muted");
        return;
      }

      labelEl.textContent = "Relationship path";

      if (pathIds.length === 1) {
        pathEl.textContent = "You";
        pathEl.classList.remove("muted");
        return;
      }

      let result = "";
      for (let i = 0; i < pathIds.length - 1; i++) {
        const aId = pathIds[i];
        const bId = pathIds[i + 1];
        const aName =
          i === 0 ? "You" : (getPersonById(aId)?.name || `Unknown(${aId})`);
        const bName = getPersonById(bId)?.name || `Unknown(${bId})`;
        const label = getRelationshipLabel(aId, bId) || "?";

        if (i === 0) {
          result += aName + " ";
        }
        result += `-(${label})-> ${bName}`;
        if (i < pathIds.length - 2) {
          result += " ";
        }
      }

      pathEl.textContent = result;
      pathEl.classList.remove("muted");
    }

    function onTargetChange(event) {
      const value = event.target.value;
      const answerEl = document.getElementById("answer");
      const pathEl = answerEl.querySelector(".answer-path");

      if (!value) {
        pathEl.textContent = "Pick someone to see how they connect to you.";
        pathEl.classList.add("muted");
        return;
      }

      const targetId = Number(value);
      const adj = buildAdjacencyList(data.relationships);
      const path = bfsPath(ME_ID, targetId, adj);

      if (!path) {
        renderPath(null);
      } else {
        renderPath(path);
      }
    }

    function init() {
      const select = document.getElementById("target-select");

      // Populate the dropdown with all people except ME_ID
      const others = data.people.filter(p => p.id !== ME_ID);
      for (const person of others) {
        const opt = document.createElement("option");
        opt.value = String(person.id);
        opt.textContent = person.name;
        select.appendChild(opt);
      }

      select.addEventListener("change", onTargetChange);
    }

    document.addEventListener("DOMContentLoaded", init);
  </script>
</body>
</html>
